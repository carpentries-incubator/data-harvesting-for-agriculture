---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 06-Experimental-Design.md in _episodes_rmd/
title: "Experimental Design"
include_overview: true
output: html_document
questions:
 - What kind of on-farm experiments do we do?
 - How do we design these experiments efficiently?
objectives:
 - Know different types of common on-farm experiments
 - Import boundary file and AB line file
 - Create AB line file with code
 - utilize the functions to create simple trial designs
keypoints:
 - Most of the code in this part would be using the functions, therefore understanding what different functions can be quite important
 - In designing the trials, the most important thing is to know how to design the experimental rates,and the tech part can be done by someone else
source: Rmd
---




<font color="magenta">Words about what we are actually doing go here</font>

The only files we need for the trial design are the boundary file, and ab line. In addition, as long as we know the actual direction the machines
will be driven on the field, we can create our own AB line with a function.


~~~
boundary.sfdf <- st_read("data/boundary.gpkg")
~~~
{: .language-r}



~~~
Reading layer `boundary' from data source `/Users/jillnaiman/trial-lesson_ag/_episodes_rmd/data/boundary.gpkg' using driver `GPKG'
Simple feature collection with 2 features and 1 field
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -82.87853 ymin: 40.83945 xmax: -82.87306 ymax: 40.8466
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
~~~
{: .output}



~~~
boundary.utm <- st_transform_utm(boundary.sfdf)
~~~
{: .language-r}



#####Field Management Info Above
We need decide on the experiment design before we get into any of the code, relative parameters we need for the trial design includes: plot dimension, number of treatments, types of treatments, and treatment range. In the following code, we are simply going to assign values to all
the parameters that might be involved in the trial design. In this way, if we ever want to change any parameters, we can do it here, and need not
to worry about the consistency for the whole code.

~~~
trialarea <- subset(boundary.utm, Type == "Trial")
~~~
{: .language-r}


###make our own AB line if you do not already have one

~~~
abline <- st_read("data/abline.gpkg")
~~~
{: .language-r}



~~~
Reading layer `abline' from data source `/Users/jillnaiman/trial-lesson_ag/_episodes_rmd/data/abline.gpkg' using driver `GPKG'
Simple feature collection with 1 feature and 1 field
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: -82.87334 ymin: 40.84301 xmax: -82.87322 ymax: 40.84611
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
~~~
{: .output}



~~~
abline_utm <- st_transform_utm(abline)
~~~
{: .language-r}



~~~
width <- m_to_ft(24)
design_grids_utm <- make_grids(trialarea, abline_utm, long_in = 'NS', short_in = 'EW', length_ft = 180, width_ft = width)

st_crs(design_grids_utm) <- st_crs(trialarea)
trial_grid <- st_intersection(trialarea, design_grids_utm)
~~~
{: .language-r}



~~~
Warning: attribute variables are assumed to be spatially constant throughout all
geometries
~~~
{: .error}



~~~
tm_shape(trial_grid) + tm_borders(col='blue')
~~~
{: .language-r}

<img src="../fig/rmd-design the checker-board plot-1.png" title="plot of chunk design the checker-board plot" alt="plot of chunk design the checker-board plot" width="612" style="display: block; margin: auto;" />

### determine treatment types
Now that we have the trial design plots, we need to assign different treatments to each plot.

~~~
whole_plot <- treat_assign(trial_grid, seed_treat_rates = c(31000, 34000, 37000, 40000), nitrogen_treat_rates = c(160,200,225,250), seed_quo = 37000, nitrogen_quo = 225)
~~~
{: .language-r}



~~~
Warning in bind_rows_(x, .id): Unequal factor levels: coercing to character
~~~
{: .error}



~~~
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
Warning in bind_rows_(x, .id): binding character and factor vector, coercing
into character vector
~~~
{: .error}



~~~
Regions defined for each Polygons
~~~
{: .output}



~~~
map_poly(whole_plot, "NRATE", "Nitrogen Treatment")
~~~
{: .language-r}

<img src="../fig/rmd-assigning treatment rates-1.png" title="plot of chunk assigning treatment rates" alt="plot of chunk assigning treatment rates" width="612" style="display: block; margin: auto;" />
plot(newfield$geom)


~~~
# infield <- st_buffer(boundary.utm, -plot_width_meter)
# outfield <- st_difference(boundary.utm, infield)
# 
# infield$dummy <- 1
# outfield$dummy <- 0
# bothfields <- rbind(infield, outfield)
# newfield <- subset(bothfields, dummy == 1)
~~~
{: .language-r}


###eg plot
  
ggplot(data = whole_plot, aes(x=long,y=lat,group=group)) +
  geom_polygon(aes(fill=factor(NRATE))) +
  scale_fill_brewer(palette = 'Greens') 

