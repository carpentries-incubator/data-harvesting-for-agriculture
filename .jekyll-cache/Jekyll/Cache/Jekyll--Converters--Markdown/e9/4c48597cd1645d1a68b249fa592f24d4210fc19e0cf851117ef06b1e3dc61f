I"•˙<!-- <font color="magenta">This could use a bit of re-writing - I just put the SSURGO stuff in with the weather data</font> -->

<blockquote class="textchunk">
  <h1 id="ssurgo-soil-data">SSURGO Soil Data</h1>

  <p>The SSURGO data is probably a dataset you are familiar with already. You can obtain a soil description of your field on the Web Soil Survey website below. The SSURGO dataset has been developed over a century of surveying land and analyzing soil samples across the United States. While the website is one way to access the soil data, R also has a package called <code class="highlighter-rouge">FedData</code> that has a function <code class="highlighter-rouge">get_ssurgo()</code> for accessing the soil data in the R environment.</p>

  <p>Link to SSURGO site: <a href="https://websoilsurvey.sc.egov.usda.gov/App/WebSoilSurvey.aspx">https://websoilsurvey.sc.egov.usda.gov/App/WebSoilSurvey.aspx</a></p>

  <h2 id="ssurgo-download">SSURGO Download</h2>
  <p>The next line brings the SSURGO data into the R environment with the name <code class="highlighter-rouge">ssurgo</code> and the  object <code class="highlighter-rouge">boundary</code> from the geospatial lesson. Note here that the class of <code class="highlighter-rouge">boundary</code> needs  to be <code class="highlighter-rouge">spatial</code> rather than <code class="highlighter-rouge">sf</code>, so we transform the object with <code class="highlighter-rouge">as(boundary,"Spatial")</code>.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">boundary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_sf</span><span class="p">(</span><span class="s2">"data/boundary.gpkg"</span><span class="p">)</span><span class="w">
</span><span class="n">boundary.sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spatial"</span><span class="p">)</span><span class="w">
</span><span class="n">ssurgo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">download_ssurgo</span><span class="p">(</span><span class="s2">"samplefield"</span><span class="p">,</span><span class="w"> </span><span class="n">boundary.sp</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Successfully downloaded SSURGO.
</code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>All done!  Woohoo!
</code></pre></div>  </div>

  <h2 id="ssurgo-data">SSURGO Data</h2>

  <p>The downloaded <code class="highlighter-rouge">ssurgo</code> is a list with 2 objects, <code class="highlighter-rouge">spatial</code> and <code class="highlighter-rouge">tabular</code>. The <code class="highlighter-rouge">spatial</code> object contains the polygons of soil types for the field, and  <code class="highlighter-rouge">tabular</code> contains many dataframes with attributes collected for the soil and soil horizons.</p>

  <p>Note that these dataframes and their relationships with one another are very complex. To use these data, you must carefully read the SSURGO documentation. <a href="https://data.nal.usda.gov/system/files/SSURGO_Metadata_-_Table_Column_Descriptions.pdf">The SSURGO Metadata Table Columns Desription document is available online,</a> and some of the segments we‚Äôre going to use are found around page 81.</p>

  <p>Merging the dataframes to have one value of the attributes for each soil polygon requires reducing the dimension of the data, often by weighting the attributes by horizon depth.</p>

  <p>Let‚Äôs make a map of the soil types on this field. First, we need to locate the part of
<code class="highlighter-rouge">tabular</code> with the soil names; these can be found in <code class="highlighter-rouge">muaggatt</code>. (From the Metadata Table Column Desriptions document linked in above, we can learn that ‚Äòmuaggatt‚Äô stands for ‚ÄòMap Unit Aggregated Attributes.‚Äô)</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ssurgo</span><span class="o">$</span><span class="n">tabular</span><span class="o">$</span><span class="n">muaggatt</span><span class="w"> 
</span></code></pre></div>  </div>

</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-soil-names">Exercise: Soil Names</h2>
  <p>What are the soil types present on the field as seen in <code class="highlighter-rouge">names</code>? Are the soil defined by anything other than the soil type?</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 9 x 40
  musym muname mustatus slopegraddcp slopegradwta brockdepmin wtdepannmin
  &lt;chr&gt; &lt;chr&gt;  &lt;lgl&gt;           &lt;dbl&gt;        &lt;dbl&gt; &lt;lgl&gt;             &lt;dbl&gt;
1 BgB   Benni‚Ä¶ NA                  4          3.9 NA                   22
2 Cr    Condi‚Ä¶ NA                  1          1   NA                    7
3 HpE   Henne‚Ä¶ NA                 30         30   NA                  153
4 Lo    Lobde‚Ä¶ NA                  1          1   NA                   69
5 Pm    Pewam‚Ä¶ NA                  1          1   NA                   15
6 Sh    Shoal‚Ä¶ NA                  1          1   NA                   31
7 BeA   Benni‚Ä¶ NA                  1          1.2 NA                   22
8 Crd1‚Ä¶ Cardi‚Ä¶ NA                  3          2.8 NA                   46
9 Crd1‚Ä¶ Cardi‚Ä¶ NA                  9          8.4 NA                   46
# ‚Ä¶ with 33 more variables: wtdepaprjunmin &lt;dbl&gt;, flodfreqdcd &lt;chr&gt;,
#   flodfreqmax &lt;chr&gt;, pondfreqprs &lt;dbl&gt;, aws025wta &lt;dbl&gt;, aws050wta &lt;dbl&gt;,
#   aws0100wta &lt;dbl&gt;, aws0150wta &lt;dbl&gt;, drclassdcd &lt;chr&gt;, drclasswettest &lt;chr&gt;,
#   hydgrpdcd &lt;chr&gt;, iccdcd &lt;lgl&gt;, iccdcdpct &lt;dbl&gt;, niccdcd &lt;dbl&gt;,
#   niccdcdpct &lt;dbl&gt;, engdwobdcd &lt;chr&gt;, engdwbdcd &lt;chr&gt;, engdwbll &lt;chr&gt;,
#   engdwbml &lt;chr&gt;, engstafdcd &lt;chr&gt;, engstafll &lt;chr&gt;, engstafml &lt;chr&gt;,
#   engsldcd &lt;chr&gt;, engsldcp &lt;chr&gt;, englrsdcd &lt;chr&gt;, engcmssdcd &lt;chr&gt;,
#   engcmssmp &lt;chr&gt;, urbrecptdcd &lt;chr&gt;, urbrecptwta &lt;dbl&gt;, forpehrtdcp &lt;chr&gt;,
#   hydclprs &lt;dbl&gt;, awmmfpwwta &lt;dbl&gt;, mukey &lt;dbl&gt;
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="exercise-discussion">Exercise Discussion</h2>
  <p>Looking at <code class="highlighter-rouge">names</code> we can see there are eight types of soil on the field, and the dataframe reports areas with different slopes with different names. We often know the slope of the field, and so we may want to combine areas of the field with the same soil type and different slopes.</p>

</blockquote>

<!-- JPN: this fixed the saving thing below: https://gis.stackexchange.com/questions/327725/st-write-fails-for-object-created-with-st-difference-using-r -->

<blockquote class="textchunk">
  <h2 id="merging-dataframes">Merging Dataframes</h2>

  <p>We need one dataframe with both the soil name and spatial data. We will merge the soil data and the spatial data by the <code class="highlighter-rouge">musym</code>. Note that in one of the dataframes the variable is capitalized and not in the other. We must rename the variable for consistency using <code class="highlighter-rouge">rename()</code> from <code class="highlighter-rouge">dplyr</code>.  We also have to do this with the <code class="highlighter-rouge">mukey</code> variable as well.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spatial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as</span><span class="p">(</span><span class="n">ssurgo</span><span class="o">$</span><span class="n">spatial</span><span class="p">,</span><span class="w"> </span><span class="s2">"sf"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spatial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">rename</span><span class="p">(</span><span class="n">spatial</span><span class="p">,</span><span class="w"> </span><span class="n">musym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MUSYM</span><span class="p">)</span><span class="w">
</span><span class="n">spatial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">rename</span><span class="p">(</span><span class="n">spatial</span><span class="p">,</span><span class="w"> </span><span class="n">mukey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MUKEY</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spatial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">spatial</span><span class="p">,</span><span class="w"> </span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"musym"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">spatial</span><span class="o">$</span><span class="n">muname</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Bennington silt loam, 0 to 2 percent slopes"
[2] "Bennington silt loam, 0 to 2 percent slopes"
[3] "Bennington silt loam, 0 to 2 percent slopes"
[4] "Bennington silt loam, 2 to 6 percent slopes"
[5] "Bennington silt loam, 2 to 6 percent slopes"
[6] "Condit-Bennington silt loams"               
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">st_write</span><span class="p">(</span><span class="n">spatial</span><span class="p">,</span><span class="w"> </span><span class="s2">"data/ssurgo.gpkg"</span><span class="p">,</span><span class="w"> </span><span class="n">layer_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'OVERWRITE=YES'</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Updating layer `ssurgo' to data source `data/ssurgo.gpkg' using driver `GPKG'
options:        OVERWRITE=YES 
Updating existing layer ssurgo
Writing 14 features with 43 fields and geometry type Multi Polygon.
</code></pre></div>  </div>

</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-create-the-soil-map">Exercise: Create the Soil Map</h2>

  <p>Use <code class="highlighter-rouge">map_poly()</code> to make a map where the polygon color is informed by the soil names in
<code class="highlighter-rouge">muname</code>.</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map_soil</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">map_poly</span><span class="p">(</span><span class="n">spatial</span><span class="p">,</span><span class="w"> </span><span class="s1">'muname'</span><span class="p">,</span><span class="w"> </span><span class="s2">"Soil Type"</span><span class="p">)</span><span class="w">
</span><span class="n">map_soil</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Some legend labels were too wide. These labels have been resized to 0.63, 0.63, 0.63, 0.52, 0.48, 0.42, 0.47. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.
</code></pre></div>    </div>

    <p><img src="../fig/rmd-map_soil_spatial-1.png" title="plot of chunk map_soil_spatial" alt="plot of chunk map_soil_spatial" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="exercise-discussion-1">Exercise Discussion</h2>
  <p>The map shows that there are quite a few soil types on the field, and several show up in different sections of the field. However, most of the soils are silt loam. It might be difficult to understand the different soils without more information about soil weathering and texture. This is also provided within SSURGO and is likely something you know about in your own field.</p>

</blockquote>

<blockquote class="textchunk">
  <h2 id="example-with-your-own-field">Example with your own field</h2>

  <p>Here we are going to download the SSURGO maps for your own field using your boundary file if you have one. Then, we are going to make a table of the clay, silt, and sand content as well as the water content of the different soil types. There is a function <code class="highlighter-rouge">c_s_s_soil()</code> in <code class="highlighter-rouge">functions.R</code> that uses the soil depth to take an average of the soil measures for each soil type. The only parameter that needs to be</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soil_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">c_s_s_soil</span><span class="p">(</span><span class="n">ssurgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssurgo</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |======================================================================| 100%
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soil_content</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    mukey AREASYMBOL SPATIALVER  MUSYM     clay     silt     sand water_storage
1 1019357      OH033         10    BeA 30.88180 49.35860 19.75960      24.93720
2  168539      OH033         10    BgB 31.09245 48.94345 19.96410      24.72030
3  168557      OH033         10     Cr 33.80601 45.40116 20.79283      21.87375
4  168570      OH033         10    HpE 28.17274 37.20299 34.62427      21.24000
5  168578      OH033         10     Lo 23.32787 49.29454 27.37760      27.86000
6  168588      OH033         10     Pm 34.08070 46.99515 18.92415      25.82340
7  168591      OH033         10     Sh 21.67045 44.65005 33.67950      31.86120
8 2996476      OH033         10 Crd1B1 30.17855 46.96980 22.85165      24.72070
9 2996690      OH033         10 Crd1C2 29.92200 45.94210 24.13590      23.14610
</code></pre></div>  </div>

</blockquote>

<blockquote class="textchunk">
  <h1 id="daymet-weather-data">Daymet Weather Data</h1>

  <p>The Oak Ridge National Laboratory produces a datset called Daymet which contains predicted
weather observations on a one meter grid. These data come from weather station climate 
observations in a climate model for prediction and include variables such as precipitation,
snow water equivalent, temperature, day length, solar radians, and vapor pressure.</p>

  <p>There is a package in r <code class="highlighter-rouge">daymetr</code> that downloads the daymet weather data within the R environment.
For a single point, you can use the command <code class="highlighter-rouge">download_daymet()</code>.
(If you want to download the data for a set of points, there is also the command <code class="highlighter-rouge">download_daymet_batch()</code> which takes an argument a .csv of the points in lat/long. If you want to use this approach, we can give you an example.)</p>

</blockquote>

<blockquote class="textchunk">
  <h2 id="using-daymetr-to-download-weather">Using daymetr to download weather</h2>
  <p>Let‚Äôs first start by using the function <code class="highlighter-rouge">read_sf</code> to load in the boundary file for our plot of land. The function <code class="highlighter-rouge">read_sf</code> is like the <code class="highlighter-rouge">read.csv</code> function we used previously to lead data, but it is designed to read in shapefiles with a simple formatting (hence the <code class="highlighter-rouge">sf</code> in its name for ‚Äúsimple figure‚Äù):</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">boundary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_sf</span><span class="p">(</span><span class="s2">"data/boundary.gpkg"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
  <p>To use <code class="highlighter-rouge">daymetr</code> to find weather data for a point, we have to give it a latitude and longitude.  We‚Äôll use the <code class="highlighter-rouge">cent_long()</code> and <code class="highlighter-rouge">cent_lat()</code> functions (from <code class="highlighter-rouge">functions.R</code>) to calculate the centers of a box that bounds our shape file.</p>

  <p>This should be a point near the middle of the field.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cent_long</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span><span class="w">
</span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cent_lat</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span><span class="w">
</span><span class="n">lat</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 40.84303
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lon</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -82.87579
</code></pre></div>  </div>

  <p>Now we‚Äôll use the function <code class="highlighter-rouge">download_daymet</code> to grab the weather from our central latitude and longitude values that we just calculated.  In addition to taking in parameters of <code class="highlighter-rouge">lat</code> and <code class="highlighter-rouge">lon</code>, we need to give this function a <code class="highlighter-rouge">start</code> and <code class="highlighter-rouge">end</code> date so that we can specify the range of years over which we want weather data.  If the data is not available for the year you request, an error will be reported. We choose 2000 to 2018 for this example; later we will use the historical data for comparison.
We also specify a name for this site - we will call the site <code class="highlighter-rouge">Field1</code>, but this can be the name of one of your fields if you use it in the future.
The final option <code class="highlighter-rouge">internal = TRUE</code> means that the daymet data is brought into the R environment rather than saved in your working directory. We may want to change the names and units of variables, so we will wait to save the data in the working directory.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weather</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">download_daymet</span><span class="p">(</span><span class="n">site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Field1"</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2018</span><span class="p">,</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Downloading DAYMET data for: Field1 at 40.8430279883331/-82.8757922217347 latitude/longitude !
</code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Done !
</code></pre></div>  </div>
</blockquote>

<blockquote class="textchunk">
  <h2 id="exploring-the-daymet-data">Exploring the daymet data</h2>
  <p>We can use <code class="highlighter-rouge">str()</code> function to explore the new daymetr object <code class="highlighter-rouge">weather</code></p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>List of 7
 $ site     : chr "Field1"
 $ tile     : num 11749
 $ latitude : num 40.8
 $ longitude: num -82.9
 $ altitude : num 310
 $ tile     : num 11749
 $ data     :'data.frame':	6935 obs. of  9 variables:
  ..$ year         : num [1:6935] 2000 2000 2000 2000 2000 2000 2000 2000 2000 2000 ...
  ..$ yday         : num [1:6935] 1 2 3 4 5 6 7 8 9 10 ...
  ..$ dayl..s.     : num [1:6935] 32832 32832 32832 33178 33178 ...
  ..$ prcp..mm.day.: num [1:6935] 0 0 8 27 0 0 0 0 0 2 ...
  ..$ srad..W.m.2. : num [1:6935] 259 234 163 182 195 ...
  ..$ swe..kg.m.2. : num [1:6935] 52 52 44 44 44 40 40 40 40 36 ...
  ..$ tmax..deg.c. : num [1:6935] 8.5 14 14.5 12 3.5 1.5 4 3.5 6.5 9 ...
  ..$ tmin..deg.c. : num [1:6935] -4.5 3 4.5 0.5 -4.5 -4.5 -4 -5.5 -1.5 3 ...
  ..$ vp..Pa.      : num [1:6935] 440 760 840 640 440 440 440 400 560 760 ...
 - attr(*, "class")= chr "daymetr"
</code></pre></div>  </div>
  <p>The object <code class="highlighter-rouge">weather</code> is a list of 7 objects, the last of which is the data. In the next excerise we will explore what variables are in this dataframe.</p>

  <p><strong>What are all those ‚Äú..‚Äù in the names under <code class="highlighter-rouge">data</code>?</strong> These just denote spaces in the original column labels. While it can be a little confusing to look at at first, they are just the default formatting R gives to these columns.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-explore-the-weather-data">Exercise: Explore the weather data</h2>

  <ol>
    <li>Assign the column <code class="highlighter-rouge">data</code> in <code class="highlighter-rouge">weather</code> to a variable with the name <code class="highlighter-rouge">weather_data</code>. (Recall how we access a column with <code class="highlighter-rouge">$</code> and how variables are assigned with a <code class="highlighter-rouge">&lt;-</code>).</li>
    <li>How is the date reported?</li>
    <li>What other variables exist?</li>
    <li>What are the units for the different variables?
 <strong>Remember:</strong> Sometimes you need to use a search engine or help(‚Äúfunctionname‚Äù) to understand what objects
 are created from a specific R function.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weather_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">weather</span><span class="o">$</span><span class="n">data</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">weather_data</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	6935 obs. of  9 variables:
 $ year         : num  2000 2000 2000 2000 2000 2000 2000 2000 2000 2000 ...
 $ yday         : num  1 2 3 4 5 6 7 8 9 10 ...
 $ dayl..s.     : num  32832 32832 32832 33178 33178 ...
 $ prcp..mm.day.: num  0 0 8 27 0 0 0 0 0 2 ...
 $ srad..W.m.2. : num  259 234 163 182 195 ...
 $ swe..kg.m.2. : num  52 52 44 44 44 40 40 40 40 36 ...
 $ tmax..deg.c. : num  8.5 14 14.5 12 3.5 1.5 4 3.5 6.5 9 ...
 $ tmin..deg.c. : num  -4.5 3 4.5 0.5 -4.5 -4.5 -4 -5.5 -1.5 3 ...
 $ vp..Pa.      : num  440 760 840 640 440 440 440 400 560 760 ...
</code></pre></div>    </div>
    <p>The date is reported as the year and day of the year. 
Other variables include day length, precipitation, solar radiation, snow water equivalent, maximum temperature, minimum temperature, and vapor pressure. 
The units for the variables are given after the variable name. For example, day length is in seconds and solar radiation is in watts per square meter. While precipitation and temperature have intuitive names, vapor pressure and snow water equivalent are not so apparent. 
You can look at the <code class="highlighter-rouge">daymetr</code> <a href="https://cran.r-project.org/web/packages/daymetr/vignettes/daymetr-vignette.html">vignette</a> to understand the meaning of these variables.</p>

  </blockquote>
</blockquote>

<blockquote class="textchunk">
  <h2 id="dates-in-dataframes">Dates in Dataframes</h2>
  <p>There are many operations we might do with dates, such as eliminating the dates outside of the growing season, but we need some way to deal with their unique formatting.
You can think of ‚Äúdates‚Äù as another variable type, like the integers and floats that we discussed in the previous episode.</p>

  <p>Once a column is of the <code class="highlighter-rouge">date</code> data type, we can perform actions
like ordering the data by time, finding the data in a certain time period, or calculating the days between two dates.</p>

  <p>R has a built-in function <code class="highlighter-rouge">as.Date()</code> which converts a column to a date.  However, our data has dates in different formats ‚Äì <code class="highlighter-rouge">year</code> is in years and <code class="highlighter-rouge">yday</code> is days the day of the year in question, starting on January 1st.  We will use one of our functions in <code class="highlighter-rouge">functions.R</code> to take this into account called <code class="highlighter-rouge">as.Date.daymetr()</code>. Make sure that you have run <code class="highlighter-rouge">source("functions.R")</code> or you will not have the function in your global environment. We create a new variable in <code class="highlighter-rouge">weather_data</code> called ‚Äúdate‚Äù:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weather_data</span><span class="o">$</span><span class="n">date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date.daymetr</span><span class="p">(</span><span class="n">weather_data</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">date</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "2000-01-01" "2000-01-02" "2000-01-03" "2000-01-04" "2000-01-05"
[6] "2000-01-06"
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">date</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Date"
</code></pre></div>  </div>
  <p>To see this code and understand how it works go to the <a href="https://github.com/data-carpentry-for-agriculture/trial-lesson/blob/gh-pages/_episodes_rmd/functions.R">functions script</a> in github.</p>
</blockquote>

<blockquote class="textchunk">
  <h2 id="unit-conversions">Unit Conversions</h2>

  <p>Publicly available data are usually given in metric units as we see in the weather data 
above, for example, the precipitation data is in millimeters:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">prcp..mm.day.</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="c1"># print 20 entries of precipitation column in mm</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1]  0  0  8 27  0  0  0  0  0  2  2  0  2  1  0  0  0  2  0  6
</code></pre></div>  </div>
  <p>We may want to have these data in imperial units as these are the units we are using
to think about yield and other values in the United States. You may know the value of crop requirements and threshholds in imperial units rather than metric units. For example, a goal of 18 inches of rain during the corn season.</p>

  <p>The R package <code class="highlighter-rouge">measurements</code> is used for converting different types of measurements from one unit to another. The 
command <code class="highlighter-rouge">conv_unit()</code> converts the column from one stated unit to another unit.
Another useful function in the package is <code class="highlighter-rouge">conv_unit_options</code> which gives the possible units for a specific kind of measure (e.g. length, area, weight, etc.).</p>

  <p>We have made simple functions for converting units using <code class="highlighter-rouge">conv_unit()</code> and these are in <code class="highlighter-rouge">functions.R</code>. For example, the function <code class="highlighter-rouge">mm_to_in()</code> can convert the daily precipitation from milimeters to inches. The following lines converts <code class="highlighter-rouge">prcp..mm.day.</code> to inches and creates a new column called <code class="highlighter-rouge">prec</code>.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weather_data</span><span class="o">$</span><span class="n">prec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mm_to_in</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">prcp..mm.day.</span><span class="p">)</span><span class="w"> </span><span class="c1"># recall: ".." is treated just like any other letter or number in R!</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">prec</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="c1"># print 20 entries of precipitation column in inches</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 0.00000000 0.00000000 0.31496063 1.06299213 0.00000000 0.00000000
 [7] 0.00000000 0.00000000 0.00000000 0.07874016 0.07874016 0.00000000
[13] 0.07874016 0.03937008 0.00000000 0.00000000 0.00000000 0.07874016
[19] 0.00000000 0.23622047
</code></pre></div>  </div>
</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-unit-conversions">Exercise: Unit Conversions</h2>

  <p>There are two temperature columns in our dataset: <code class="highlighter-rouge">tmax..deg.c.</code> and <code class="highlighter-rouge">tmin..deg.c.</code> which give the minimum and maximum temperature measured on a particular day.</p>
  <ol>
    <li>Convert the two temperature variables into fahrenheit from celsius using the function <code class="highlighter-rouge">c_to_f()</code>. The function <code class="highlighter-rouge">c_to_f()</code> is like the <code class="highlighter-rouge">mm_to_in</code> column but instead of taking in a precipitation column it takes in a temperature column.</li>
    <li>Save these to new columns called <code class="highlighter-rouge">tmax</code> and <code class="highlighter-rouge">tmin</code>.</li>
    <li>What is the maximum and minimum temperature recorded? (Hint: recall the <code class="highlighter-rouge">min</code> and <code class="highlighter-rouge">max</code> functions from the previous episodes)</li>
  </ol>

  <blockquote class="solution">
    <h2 id="exercise-solutions">Exercise Solutions</h2>

    <p>Let‚Äôs start by looking at our original columns:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmax..deg.c.</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1"># maximum daily temp in C</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1]  8.5 14.0 14.5 12.0  3.5  1.5  4.0  3.5  6.5  9.0
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmin..deg.c.</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1"># minimum daily temp in C</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] -4.5  3.0  4.5  0.5 -4.5 -4.5 -4.0 -5.5 -1.5  3.0
</code></pre></div>    </div>
    <p>Now let‚Äôs convert them from C to F using the <code class="highlighter-rouge">c_to_f</code> function:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weather_data</span><span class="o">$</span><span class="n">tmax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">c_to_f</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmax..deg.c.</span><span class="p">)</span><span class="w"> 
</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">c_to_f</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmin..deg.c.</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>And let‚Äôs look at our transformed data set:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmax</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1"># maximum daily temp in F</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 47.3 57.2 58.1 53.6 38.3 34.7 39.2 38.3 43.7 48.2
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmin</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1"># minimum daily temp in F</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 23.9 37.4 40.1 32.9 23.9 23.9 24.8 22.1 29.3 37.4
</code></pre></div>    </div>
    <p>Finally, let‚Äôs figure out what the maximum and minimum recorded temperatures are.  The overall maximum temperature will be the maximum of the <code class="highlighter-rouge">tmax</code> column, and likewise with the minimum.  Remembering back to when we used the <code class="highlighter-rouge">max</code> function before we can calculate the overall maximum temperature with:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">max</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmax</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 97.7
</code></pre></div>    </div>
    <p>Similarly for the min temperature:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">min</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">tmin</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -16.6
</code></pre></div>    </div>
    <p>The maximum temperature during this time period was 97.7 degrees, and the minimum temperature was -16.6 degrees.</p>
  </blockquote>
</blockquote>

<blockquote class="textchunk">
  <h2 id="precipitation-graph">Precipitation Graph</h2>

  <p>Perhaps you want to see what the weather this year was like compared to the typical year.
We are going make a graph showing the total monthly precipitation from
2018 compared to the average precipitation from the years 2000 to 2017. This is a common way
to look at seasonal rainfall and allows us to look at the rainfall during the critical months
of July and August. First, we need to organize the data in a new dataset with the average total rainfall for each month.</p>
</blockquote>

<blockquote class="textchunk">
  <h1 id="adding-a-month-variable">Adding a month variable</h1>

  <p>Currently, there is no month variable in our dataframe. Once you have a date object, there is a package called <code class="highlighter-rouge">lubridate</code>
that facilitates additional time or date related calculations. Perhaps you want a new column with the day of the week or a measure of time lapsed between two observations. We use the command <code class="highlighter-rouge">month()</code> to add a 
variable called <code class="highlighter-rouge">month</code> to the dataframe. The option <code class="highlighter-rouge">label = TRUE</code> creates a string with the 
month name instead of a number. We use this option because the month name will look better on the graph than a number.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weather_data</span><span class="o">$</span><span class="n">month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lubridate</span><span class="o">::</span><span class="n">month</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">weather_data</span><span class="o">$</span><span class="n">month</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] Jan Jan Jan Jan Jan Jan
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec
</code></pre></div>  </div>
  <p>Hey what is this <code class="highlighter-rouge">::</code> we just used?  Its just to explicitly say that the function <code class="highlighter-rouge">month</code> comes from the library <code class="highlighter-rouge">lubridate</code>.  This can be important because different libraries may have the same function names.</p>

  <p>This is a good time to save the dataframe in a file in your working directory. The function <code class="highlighter-rouge">write.csv()</code> writes a dataframe (<code class="highlighter-rouge">weather_data</code>) to the working directory with a name you supply (weather_2000_2018.csv).</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.csv</span><span class="p">(</span><span class="n">weather_data</span><span class="p">,</span><span class="w"> </span><span class="s2">"weather_2000_2018.csv"</span><span class="p">)</span><span class="w"> 
</span></code></pre></div>  </div>
</blockquote>

<blockquote class="textchunk">
  <h2 id="taking-sum-or-average-by-groups">Taking sum or average by groups</h2>

  <p>Now, we need to sum the daily precipitation for each year and month combination. There is a 
package called <code class="highlighter-rouge">dplyr</code> that helps with many kinds of data manipulation. A popular task is to 
perform an action over a group, like taking the sum of something. The functions <code class="highlighter-rouge">sumprec_by_monthyear()</code> and <code class="highlighter-rouge">avgprec_by_month()</code> are in <code class="highlighter-rouge">functions.R</code> and use the <code class="highlighter-rouge">dplyr</code> package to calculate total and average precipitation by month.</p>

  <p>First we use the command to calculate the total precipitation for each month in each year.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">by_month_year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sumprec_by_monthyear</span><span class="p">(</span><span class="n">weather_data</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">by_month_year</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 3
# Groups:   month [1]
  month  year prec_month
  &lt;ord&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 Jan    2000      2.44 
2 Jan    2001      0.984
3 Jan    2002      1.69 
4 Jan    2003      1.65 
5 Jan    2004      3.31 
6 Jan    2005      7.68 
</code></pre></div>  </div>
  <p>Why only the month of January?  Because this dataframe is ordered by months.  We can see all the months are in our dataset if we look at the <code class="highlighter-rouge">Levels</code> of this column:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">by_month_year</span><span class="o">$</span><span class="n">month</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] Jan Jan Jan Jan Jan Jan
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec
</code></pre></div>  </div>

  <p>Now we have a dataframe with the rainfall for each month of each year, where the first rows of the dataframe are for January.</p>
</blockquote>

<blockquote class="callout">
  <h2 id="more-information-about-dplyr">More information about <code class="highlighter-rouge">dplyr</code></h2>
  <p>One great way to get more information about professionally published packages is through <code class="highlighter-rouge">vignette</code>: a function that will give you extensive documentation in R.  You can use this with:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vignette</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

</blockquote>

<blockquote class="textchunk">
  <h2 id="subsetting-the-data">Subsetting the data</h2>

  <p>Now we want to separate the 2018 data from the rest of the years 
before we take the average monthly precipitation. Separating part of the dataframe is called subsetting. A subset is a set of observations that are all present in an existing dataframe; generally, the subset will have some characteristic in common such as year, month, etc. The function <code class="highlighter-rouge">subset()</code> requires two inputs, the dataframe to be subsetted and the characteristics to subset on in the form of logical expressions. We will take the subset of <code class="highlighter-rouge">by_month_year</code> that is in 2018.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">monthprec_2018</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">by_month_year</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2018</span><span class="p">)</span><span class="w"> 
</span></code></pre></div>  </div>
</blockquote>

<blockquote class="callout">
  <h2 id="why-the-double-">Why the double <code class="highlighter-rouge">==</code>?</h2>
  <p>You‚Äôll note in our <code class="highlighter-rouge">subset()</code> call, we used a <code class="highlighter-rouge">==</code> instead of a <code class="highlighter-rouge">=</code>.  In a function (and in R in general), the <code class="highlighter-rouge">=</code> sign is reserved for a special action - setting a parameter in that function.  Here we want to <em>look for</em> places in the <code class="highlighter-rouge">year</code> column in our <code class="highlighter-rouge">monthprec_2018</code> dataframe that have the value of <code class="highlighter-rouge">2018</code>, so we need to call this function a little differently.</p>

  <p>We can also ask the ‚Äúopposite‚Äù question and look for years that <em>are not</em> 2018 with the <code class="highlighter-rouge">!=</code> symbol instead of the <code class="highlighter-rouge">==</code> symbol in the <code class="highlighter-rouge">subset()</code> function call.  Let‚Äôs practice this now:</p>

</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-subsetting">Exercise: Subsetting</h2>

  <ol>
    <li>Find the total precipitation in June of 2015.</li>
    <li>Create a subset of <code class="highlighter-rouge">by_month_year</code> that contain all the years <em>except</em> 2018.  Call this new variable <code class="highlighter-rouge">monthprec_not_2018</code>.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="exercise-solution">Exercise Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">monthprec_2015</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">by_month_year</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2015</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">monthprec_2015</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 3
# Groups:   month [6]
  month  year prec_month
  &lt;ord&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 Jan    2015       2.28
2 Feb    2015       1.57
3 Mar    2015       2.52
4 Apr    2015       3.74
5 May    2015       3.58
6 Jun    2015       7.24
</code></pre></div>    </div>
    <p>We see that the monthly rainfall in June was 7.91 inches. 
and:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">monthprec_not_2018</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">by_month_year</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">2018</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">monthprec_not_2018</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 3
# Groups:   month [1]
  month  year prec_month
  &lt;ord&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 Jan    2000      2.44 
2 Jan    2001      0.984
3 Jan    2002      1.69 
4 Jan    2003      1.65 
5 Jan    2004      3.31 
6 Jan    2005      7.68 
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<!-- <font color="magenta">JPN: Do we need this subsetting here?  Do we ever use `&` again?  We haven't introduced boolean operations at all until right now so we should be sure we actually need it</font> -->

<blockquote class="textchunk">
  <p>We could also find this by taking a subset with the year and month:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">subset</span><span class="p">(</span><span class="n">by_month_year</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2015</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Jun"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 x 3
# Groups:   month [1]
  month  year prec_month
  &lt;ord&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 Jun    2015       7.24
</code></pre></div>  </div>
  <p>Here we use the <code class="highlighter-rouge">&amp;</code> to say we want <em>two different</em> conditions to be met in our subset.</p>
</blockquote>

<blockquote class="textchunk">
  <h2 id="take-the-average-of-monthly-rainfall">Take the average of monthly rainfall</h2>

  <p>Instead of taking the sum let‚Äôs generate the <em>average</em> precipitation per month over all years that were <em>not</em> the year 2018:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">monthprec_avg_not_2018</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">avgprec_by_month</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">by_month_year</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">2018</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">monthprec_avg_not_2018</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 2
  month prec_avg
  &lt;ord&gt;    &lt;dbl&gt;
1 Jan       2.86
2 Feb       2.31
3 Mar       2.89
4 Apr       3.69
5 May       4.61
6 Jun       4.74
</code></pre></div>  </div>

  <h2 id="merging">Merging</h2>

  <p>We now have two separate dataframes <code class="highlighter-rouge">monthprec_2018</code> which gives the monthly precipitation by month in the year 2018 and <code class="highlighter-rouge">monthprec_avg_not_2018</code> 
with the average rainfall for each
month in all the years prior to 2018.  We can use the common variable <code class="highlighter-rouge">month</code> to merge them into
one dataframe using the <code class="highlighter-rouge">merge()</code>
function.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prec_merged</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">monthprec_2018</span><span class="p">,</span><span class="w"> </span><span class="n">monthprec_avg_not_2018</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"month"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<blockquote class="textchunk">
  <h2 id="making-the-graph">Making the graph</h2>

  <p>We will now use a function <code class="highlighter-rouge">month_prec_graph()</code> to make a graph with the monthly precipitation represented by the height of the bar, and the color of the bar is determined by whether the 2018 precipitation was above or below the average precipitation.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">month_prec_graph</span><span class="p">(</span><span class="n">prec_merged</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="../fig/rmd-precgraph-1.png" title="plot of chunk precgraph" alt="plot of chunk precgraph" width="612" style="display: block; margin: auto;" /></p>

  <p>The most notable feature of the weather graph is the below average rainfall in July, the most 
critical growing period for corn. To understand whether this affected yield on the field, we
woud also need to look at historic yield. But on your field, you will know those historic
average and be able to have a pretty clear idea of how weather impacted the average yield in
a growing season.</p>

  <p>There are many possible uses for this weather data. You can calculate cumulative rainfall when it rains for consecutive days or calculate the accumulated GDD. These are more complex operations, but we can help you with the code if you are interested.</p>
</blockquote>
<!--
<font color="magenta">JPN: Here we have to explain ggplot in more detail or we have to make this into a function that just takes in this dataframe and makes this plot.  My vote is to functionize it. Also, there are no legends on this plot. </font>
--->
:ET